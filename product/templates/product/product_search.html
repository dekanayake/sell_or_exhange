{% extends "base.html" %}
{% load widget_tweaks %}

{% block content %}

<div class="container">


    <div class="row">
        <div class="col-sm-12">


                <div class="card card-block">
                    <form method="get" action="/products/search">
                        <div class="row">
                            <div class="col-xs-4">
                                {{ form.q|attr:"class:form-control"|attr:"placeholder:What are you looking for?" }}
                            </div>
                            <div class="col-xs-3">
                                <select class="form-control" name="{{ form.category.html_name }}" id="{{ form.category.id_for_label }}"  >
                                    {% if selected_category%}
                                        <option value="{{selected_category.0}}" selected hidden>{{selected_category.1}}</option>
                                    {% else%}
                                        <option value="1" disabled  selected hidden>Category</option>
                                    {% endif %}
                                    <option value="-1">All categories</option>
                                    {% for category,childCategories in categoryList.items %}

                                        <option value="{{category.0}}" > {{category.1}}</option>

                                        {% if childCategories %}
                                            {% for childCategory in childCategories.keys %}
                                                <option value="{{childCategory.0}}" {% ifequal childCategory.0|slugify  form.category.value %} selected {% endifequal %}> &nbsp;&nbsp;&nbsp;{{childCategory.1}}</option>
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-xs-3">
                                <select class="form-control">
                                    <option value="" disabled selected hidden>Location</option>
                                    <option>Test</option>
                                </select>
                            </div>
                            <div class="col-xs-1">

                                    <button type="submit" class="btn btn-primary">Search</button>

                            </div>
                        </div>
                    </form>
                </div>



        </div>
    </div>

    <div class="row">
        <div class="col-sm-12">
            <div class="card card-block">
                "{{form.q.value}}" in {{selected_category.1}} | {{page_obj.paginator.count}}
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-3">
            <div class="card ">
                <div class="card-header" role="tab" id="debtorHeader">
                    <div class="row">
                        <div class="col-xs-8">
                            <h7 class="card-title">
                                    Categories
                            </h7>
                            <div class="card-subtitle text-muted"><small>{{selected_category.1}}</small></div>
                        </div>
                        <div class="col-xs-4">
                            <a class="pull-right" href="
                               {%if not category_facet_hide%}
                                    {{ request.get_full_path }}&amp;category_facet_hide=Y
                               {% else %}
                                      {{ category_facet_expand_url }}
                               {% endif %}
                               ">
                                {% if category_facet_hide %}
                                 <i class="fa fa-plus-square" aria-hidden="true"></i>
                                {% else %}
                                    <i class="fa fa-minus-square" aria-hidden="true"></i>
                                {% endif %}

                            </a>
                        </div>
                    </div>

                </div>
                 {% if not category_facet_hide%}
                  <div class="card-block facets" >
                      {% include "product/product_search/category_list.html" with categoryTree=category_facet_category_tree childCategories=category_facet_child_categories selected_category=selected_category%}
                  </div>
                  {% endif %}
            </div>
            {% if condition_facet_fields %}
                {% include "product/product_search/facet.html" with facet_name="condition" facet_display_name="Condition" facet_fields=condition_facet_fields selected_facet=condition_facet_selected_facet selected_facet_url=condition_facet_selected_facet_url facet_hide=condition_facet_hide facet_expand_url=condition_facet_expand_url %}
            {% endif %}
            {% if brand_facet_fields %}
                {% include "product/product_search/facet.html" with facet_name="brand" facet_display_name="Brand" facet_fields=brand_facet_fields selected_facet=brand_facet_selected_facet selected_facet_url=brand_facet_selected_facet_url facet_hide=brand_facet_hide facet_expand_url=brand_facet_expand_url %}
            {% endif %}
            {% include "product/product_search/variant_list.html"  %}
            {% include "product/product_search/price_facet.html" %}
            <div class="col-sm-3 p-b-3">

            </div>
        </div>

        <div class="col-sm-9 p-l-0">
            <div class="card card-block">
                <div class="row">
                    <div class="col-sm-6"></div>
                    <div class="col-sm-2"></div>
                    <div class="col-sm-4 pull-right">
                        <div class="form-inline">
                            <div class="form-group">
                                <label >Sort by</label>
                                <select class="form-control" id="sortSelect" data-url="{{sort_by_url}}">
                                    <option value="postedDate" {%if selected_sort_by = 'postedDate'%} selected {% endif %}>Most recent</option>
                                    <option value="price" {%if selected_sort_by = 'price'%} selected {% endif %}>Low prices</option>
                                    <option value="-price" {%if selected_sort_by = '-price'%} selected {% endif %}>High prices</option>
                                </select>
                            </div>
                       </div>
                    </div>
                </div>
            </div>


        {% for result in page_obj.object_list %}
            {% include "product/product_search/product_row.html" with result=result %}
        {% endfor %}

        {% if paginate %}
          <div class="text-xs-center">
            <nav aria-label="Page navigation">
                <ul class="pagination">
                    <li class="page-item {% if not page_previous_page_number %} disabled {% endif %}">
                        <a class="page-link" href="{{page_url}}&page={{page_previous_page_number}}" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                            <span class="sr-only">Previous</span>
                        </a>
                    </li>
                    {% for page in page_range %}
                        <li class="page-item {% if page == page_selected %} active {% endif %}"><a class="page-link" href="{{page_url}}&page={{page}}">{{page}}</a></li>
                    {% endfor %}
                    <li class="page-item {% if not page_next_page_number %} disabled {% endif %}">
                        <a class="page-link" href="{{page_url}}&page={{page_next_page_number}}" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                            <span class="sr-only">Next</span>
                        </a>
                    </li>
                </ul>
            </nav>
              <p class="text-primary font-weight-normal"> Results {{page_obj.start_index}} to {{page_obj.end_index}} of {{page_obj.paginator.count}} Ads</p>
          </div>
         {% endif %}
        </div>
    </div>

</div>

{% endblock %}


{% block jscontent%}


<script type="text/javascript">

    {% include "product/product_search/price_facet.js" %}

    $(document).ready(function(){

        $('#sortSelect').bind('change',function() {
              var sortField = $('#sortSelect option:selected').val();
              var url = $("#sortSelect").data("url");

              if (sortField){
                 url = url.concat('&sort_by=' + escape(sortField));
              }


              window.location.href = url;
        });

   });
</script>

{% endblock %}
